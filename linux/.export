# shellcheck disable=SC2148
# https://github.com/keybase/keybase-issues/issues/2798
GPG_TTY="$(tty)"
export GPG_TTY
export LANG=en_US.UTF-8
export TZ=UTC-8
# default editor
export EDITOR=vim
# Always display git dirty state
export GIT_PS1_SHOWDIRTYSTATE=1
# Enable Node.js (chalk) color
export FORCE_COLOR=1
# PATH updates - Add `~/.local/bin`:
_localbin="$HOME/.local/bin"
if [[ -d "$_localbin" && ":$PATH:" != *":$_localbin:"* ]]; then
  export PATH="$_localbin:$PATH"
fi
# PATH updates -
case "$OSTYPE" in
darwin*)
  # NOTES: macOS's default PATH (definition in `/etc/paths`):
  #   "/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"
  #
  # A `/Library/Apple/usr/bin` path will be added when the
  # Xcode command line tools is installed.

  # PATH updates - Add super bin directory installed by Homebrew:
  if [[ -d "/usr/local/sbin" && ":$PATH:" != *":/usr/local/sbin:"* ]]; then
    export PATH="/usr/local/sbin:$PATH"
  fi

  # bash-completion:
  _bashcomp="/usr/local/etc/bash_completion"
  # shellcheck disable=SC1090
  [ -f "$_bashcomp" ] && source "$_bashcomp"

  # Ruby rbenv:
  [ -x "$(command -v rbenv)" ] && eval "$(rbenv init -)"
  ;;
linux*)
  # PATH updates - Add linuxbrew:
  _linuxbrew1="/home/linuxbrew/.linuxbrew/bin/brew" # sudo
  [[ -f $_linuxbrew1 ]] && eval "$($_linuxbrew1 shellenv)"
  _linuxbrew2="$HOME/.linuxbrew/bin/brew" # non sudo
  [[ -f $_linuxbrew2 ]] && eval "$($_linuxbrew2 shellenv)"

  # Add git-prompt (Arch Linux):
  _gitprompt="/usr/share/git/completion/git-prompt.sh"
  # shellcheck disable=SC1090
  [ -f "$_gitprompt" ] && source "$_gitprompt"
  ;;
esac

# Encoding stuff for the terminal
export VOLTA_HOME="$HOME/.volta"
export PATH="$VOLTA_HOME/bin:$PATH"
export PATH="/usr/local/sbin:$PATH"
export PATH="/usr/local/opt/openjdk/bin:$PATH"
# Created by `pipx` on 2022-06-30 03:13:27
export PATH="$PATH:$HOME/.local/bin"
export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"
# pnpm
export PNPM_HOME="$HOME/Library/pnpm"
export PATH="$PNPM_HOME:$PATH"
# pnpm end

# -------------------------------- #
# Alias
# -------------------------------- #
# Open
case "$OSTYPE" in
darwin*)
  alias here="open ."
  ;;
msys*)
  # winpty fixes
  alias ipconfig="winpty ipconfig"
  alias nslookup="winpty nslookup"
  alias ping="winpty ping"
  # Emulate ifconfig on Windows MSYS
  alias ifconfig="ipconfig"
  alias open="explorer"
  alias here="open ."
  ;;
esac
alias c="clear"
alias :q="exit"
alias ..="cd .."
alias ...="cd ../.."
alias myip="curl -s https://api.ip.sb/ip"
# Print each PATH entry on a separate line
alias path='echo -e ${PATH//:/\\n}'
# Reload the shell (i.e. invoke as a login shell)
alias reload='exec ${SHELL} -l'
# IP addresses
alias localip="ipconfig getifaddr en0"
alias ips="ifconfig -a | grep -o 'inet6\? \(addr:\)\?\s\?\(\(\([0-9]\+\.\)\{3\}[0-9]\+\)\|[a-fA-F0-9:]\+\)' | awk '{ sub(/inet6? (addr:)? ?/, \"\"); print }'"

alias ping="prettyping"
alias cat="less"
alias log='lnav'
alias vi='vim'

# tmux
alias ctm='tmux new -s'
alias ktm='tmux kill-session -t'
alias ltm='tmux ls'
alias atm='tmux attach -t'
alias stm="tmux switch -t"

# https://snarky.ca/why-you-should-use-python-m-pip/
alias pip='pip3'
alias pipx='python3 -m pipx'
alias trees="find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'"
alias neo="neofetch"
alias du="ncdu --color dark -rr -x --exclude .git --exclude node"

#--------------------#
#  ls and dircolors  #
#--------------------#

# Detect which `ls` flavor is in use
if ls --color >/dev/null 2>&1; then # GNU `ls`
  colorflag="--color"
  export LS_COLORS='no=00:fi=00:di=01;31:ln=01;36:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.gz=01;31:*.bz2=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.avi=01;35:*.fli=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.ogg=01;35:*.mp3=01;35:*.wav=01;35:'
else # macOS `ls`
  # shellcheck disable=SC2034
  colorflag="-G"
  export LSCOLORS='BxBxhxDxfxhxhxhxhxcxcx'
fi

# LS_COLORS generated by [vivid](https://github.com/sharkdp/vivid)
if [ -x "$(command -v vivid)" ]; then
  # shellcheck disable=SC2155
  export LS_COLORS="$(vivid -m 8-bit generate snazzy)"
fi
# Uniform `ls` command on all platforms
case "$OSTYPE" in
darwin*)
  if [ -x "$(command -v gls)" ]; then
    alias ls='gls -F --group-directories-first --color' # GNU ls
  else
    alias ls="ls -F -G" # BSD/macOS ls
  fi
  ;;
linux* | msys*)
  # Too many unconcerned files and directories in Windows $HOME, ignore them.
  ignoreList=("_viminfo" "navdb.csv" "NTUSER*" "ntuser*" "Local Settings*"
    "Application Data*" "My Documents*" "NetHood*" "PrintHood*" "Recent*"
    "SendTo*" "Templates*" "Cookies*" "3D Objects" "Thumbs.db" "Start Menu"
    "desktop.ini" "Saved Games" "Creative Cloud Files")
  for item in "${ignoreList[@]}"; do
    lsIgnore+="'$item',"
  done

  # shellcheck disable=SC2139
  alias ls="ls -F --group-directories-first --color --ignore={$lsIgnore}"
  ;;
esac
alias l="ls"
alias la="ls -A"
alias ll="ls -lh"
alias lla="ls -lhA"
